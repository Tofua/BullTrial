<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Power BI Report Embed</title>
  <!-- Include the Power BI client library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/powerbi-client/2.19.1/powerbi.min.js"></script>
</head>
<body>
  <!-- Report container -->
  <div id="reportContainer" style="height:600px;"></div>

  <script>
    // URL of your token service
    const tokenUrl = "https://powerbi-auth-api-a7d4aydgc2d4hrhu.uksouth-01.azurewebsites.net/get-token";

    // Define the embed configuration without the token yet
    let embedConfiguration = {
      type: 'report',
      tokenType: window['powerbi-client'].models.TokenType.Embed,
      accessToken: "",  // Will be populated after fetching token
      embedUrl: "https://app.powerbi.com/reportEmbed?reportId=782913b3-f792-4f84-bc87-d46092f64932&autoAuth=true&ctid=37732b96-4974-4df0-ae3d-3f5bab5f9564",
      id: "782913b3-f792-4f84-bc87-d46092f64932",
      settings: {
        filterPaneEnabled: false,
        navContentPaneEnabled: false
      }
    };

    // Fetch the embed token from your token service
    fetch(tokenUrl)
      .then(response => response.json())
      .then(data => {
        // Assuming your token service returns a JSON with a "token" property
        embedConfiguration.accessToken = data.token;
        // Get the container element
        const reportContainer = document.getElementById('reportContainer');
        // Embed the report into the container
        const report = window['powerbi-client'].embed(reportContainer, embedConfiguration);
      })
      .catch(error => {
        console.error("Error fetching the embed token:", error);
      });
  </script>
</body>
</html>
